### Kafka
Платформа, обеспечивающая избыточность, достаточную для хранения абсурдно огромных объемов данных.
Здесь предоставляется шина сообщений с колоссальной пропускной способностью, на которой можно в
реальном времени обрабатывать абсолютно все проходящие через нее данные.

Если коротко, то - распределенный горизонтально масштабируемый отказоустойчивый журнал коммитов.

[Статья к прочтению](https://habr.com/ru/companies/piter/articles/352978/)
#### Описание
##### Распределенный
Работает по принципу кластера.  
Плюсы:
- высокодоступность
- отказоустойчивость
##### Горизонтально масштабируемый
Наращивание производительности не за счет ресурсов машины, на которой поднято приложение, а за счет N количества таких 
машин.  
##### Отказоустойчивость
Возможность бесперебойной работы, даже когда несколько кластеров вышли из строя.
##### Журнал коммитов
Долговременная упорядоченная структура данных, причем, данные в такую структуру можно только добавлять.

Kafka хранит все сообщения на диске

- Чтения и записи, время О(1)
- Чтение и запись не влияют друг на друга

#### Принцип работы
- Генератор высылает данные 
- Данные передаются на узел
- Данные обрабатываются потребителями
- Указанные сообщения сохраняются в теме
- Потребители подписываясь на тему получают возможность получать сообщения из неё
- Темы могут партиционироваться.
- Порядок поступления сообщений тему сохраняется
- 
#### Долговременное хранение на диске
- Объединяет сообщения в группы 
- Линейные операции быстры
- Линейные операции оптимизируются путем опережающего чтения и запаздывающей записи
- ОС кешируют часть диска в оперативе (страничный кеш)
- Оптимизация нулевого копирования (копирует данные из страничного кэша прямо на сокет)

#### Распределение и репликация данных
##### Репликация данных
- Репликация на множестве брокеров
- Возможность конфигурации гарантий доставки
##### Zookeeper
Распределенное хранилище ключей и значений. Оно сильно оптимизировано для считывания, но записи в нем происходят 
медленнее. Чаще всего Zookeeper применяется для хранения метаданных и обработки механизмов кластеризации 
(пульс, распределенные операции обновления/конфигурации, т.д.).
- Смещение групп потребителей в рамках секции (хотя, современные клиенты хранят смещения в отдельной теме Kafka)
- ACL (списки контроля доступа)—используются для ограничения доступа /авторизации
- Квоты генераторов и потребителей — максимальные предельные количества сообщений в секунду
- Ведущие секций и уровень их работоспособности

#### Как генератор/потребитель определяет ведущего брокера данной секции?
С помощью zookeeper 
#### Потоки
Потоковый процессор в Kafka отвечает за всю следующую работу: принимает непрерывные потоки данных от входных тем,
каким-то образом обрабатывает этот ввод и подает поток данных на выходные темы

#### Обработка без сохранения состояния
Обработка без сохранения состояния — это поток детерминированной обработки, не зависящий ни от каких внешних факторов.
В качестве примера рассмотрим вот такое простое преобразование данных: прикрепляем информацию к строке

##### Потоково-табличный дуализм
Важно понимать, что потоки и таблицы – это, в сущности, одно и то же. Поток можно интерпретировать как таблицу, 
а таблицу – как поток.
##### Поток как таблица
Поток Kafka можно интерпретировать точно так же – как поток обновлений для данных, которые агрегируются и дают 
конечный результат, фигурирующий в таблице

##### Таблица как поток
Таблицу можно считать мгновенным снимком, отражающим последнее значение для каждого ключа в потоке

#### Обработка с сохранением состояния
Для данного подхода необходимо где-то хранить состояние.  
Потоковый процессор хранит состояние в локальной таблице, которую будет обновлять входной поток.

#### Когда стоит использовать Kafka?
Когда необходимо мощное связующее звено и разграничение коммунакации с гарантиями доставки

#### Итоги
Apache Kafka – это распределенная потоковая платформа, позволяющая обрабатывать триллионы событий в день.
Kafka гарантирует минимальные задержки, высокую пропускную способность, предоставляет отказоустойчивые конвейеры,
работающие по принципу «публикация/подписка» и позволяет обрабатывать потоки событий.

