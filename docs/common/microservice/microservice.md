## Микросервисы
### Общее описания
Микросервисная архитектура — это способ структурирования системы, при которой несколько независимых сервисов общаются 
друг с другом определенным образом (обычно это происходит с помощью web-сервисов RESTful). Ключевая особенность состоит 
в том, что каждый микросервис способен обновляться и развертываться независимо от остальных.  

Архитектура микросервисов определяет не только то, как вы создаете свое приложение, но и то, как организована 
ваша команда.

Один из принципов - "Умные приёмники - глупые каналы".  
Приложения, построенные с использованием микросервисной архитектуры, стремятся быть настолько незавимыми (decoupled) и
сфокусировнными (cohesive), насколько возможно: они содержат собственную доменную логику и выступают больше в 
качестве фильтров в классическом Unix-овом смысле — получают запросы, применяют логику и отправляют ответ. 
Вместо сложных протоколов, таких как WS-* или BPEL, они используют простые REST-овые протоколы.

### Преимущества
#### Простота развёртывания
Можно развертывать только изменяющиеся микросервисы, независимо от остальной системы, что позволяет производить 
обновления чаще и быстрее.

#### Оптимальность масштабирования
Можно расширять только те сервисы, которые в этом нуждаются, то есть сервисы с наименьшей производительностью, 
оставляя работать остальные части системы на менее мощном оборудовании.

#### Устойчивость к сбоям
Отказ одного сервиса не приводит к остановке системы в целом. Когда же ошибка исправлена, необходимое изменение можно 
развернуть только для соответствующего сервиса — вместо повторного развертывания всего приложения. Правда, для этого
еще на этапе проектирования микросервисов потребуется тщательно продумать связи между ними для достижения максимальной
независимости друг от друга, а также заложить возможность корректного оповещения пользователя о временной недоступности 
определенного сервиса без ущерба для всей системы.

#### Возможность выбора технологий
Можно подбирать различные наборы технологий, оптимальные для решения задач, стоящих перед отдельными сервисами.

#### Небольшие команды разработки
При разработке микросервисов команды принято закреплять за конкретными бизнес-задачами (и сервисами, соответственно). 
Такие команды, как правило, показывают большую эффективность, а управлять ими легче.

#### Уменьшение дублирования функциональностей
Присутствует возможность повторного использования функциональности для различных целей и различными способами.

#### Упрощение замены сервисов при необходимости
Небольшие сервисы проще заменить на более подходящую версию или удалить вовсе — это несет значительно меньше рисков по 
сравнению с монолитным приложением.

#### Независимость моделей данных
Каждый микросервис, как правило, использует собственное хранилище данных — поэтому изменение модели данных в одном 
сервисе не влияет на работу остальных.

### Недостатки
#### Распределенная система
Микросервисы по своей природе распределены, а это, как известно, имеет свои недостатки: удаленные вызовы медленнее и 
чаще подвержены сбоям. Если ваш микросервис обращается к десятку других микросервисов, а те, в свою очередь, вызывают
еще несколько, то итоговое время отклика значительно возрастает. Также по мере увеличения взаимодействий микросервисов 
друг с другом возрастает и число возможных точек отказа.

Известны несколько путей решения этой проблемы:

- Первый — изменить детализацию своих вызовов таким образом, чтобы сократить их количество.
- Второй — использовать асинхронность: при параллельном выполнении нескольких вызовов конечное время отклика будет 
определяться самым медленным из них, а не суммой всех задержек.  

Оба метода усложняют модель программирования и увеличивают требования к квалификации.

#### Усложнение процессов и повышение требований к команде
Рост числа небольших независимых сервисов неизбежно увеличивает операционную сложность. Возрастает роль непрерывной
интеграции и доставки, ведь невозможно обрабатывать десятки услуг без автоматизации их тестирования и развертывания.
Повышаются требования к мониторингу, особенно в силу технологической разнородности сервисов.

Чтобы справиться с возросшей нагрузкой, компании нужно овладеть целым рядом новых навыков и инструментов, и важнейший
из них — внедрение культуры DevOps. Необходимо обеспечить тесное сотрудничество программистов, тестировщиков, инженеров 
сопровождения и прочих участников разработки продукта на всех этапах его жизненного цикла. Далеко не все организации 
смогут справиться с таким количеством изменений. Но культурные изменения необходимы.

#### Необходимость поддержания согласованности приложения
Микросервисы порождают возможные проблемы с согласованностью из-за применяемого в них децентрализованного управления 
данными. В монолитном приложении можно выполнить множество связанных изменений за одну транзакцию, и вы будете уверены,
что в случае сбоя произойдет откат и согласованность данных сохранится.

Микросервисам же требуется несколько ресурсов для выполнения цепочки изменений, распределенные транзакции не
приветствуются — поэтому может возникнуть ситуация, когда при обновлении одного компонента временно перестанет 
отвечать другой, ожидая завершения операции на первом.

Конечно, при разработке определенных сервисов можно отдать предпочтение не согласованности, а доступности: чтобы в
случае обновления или выхода из строя одного сервиса, другие продолжали работу. Но делать это нужно крайне осторожно,
чтобы бизнес-логика не принимала решений на основе противоречивой информации.

Таким образом, при неоправданном использовании микросервисов многие их преимущества могут быть сведены на нет. Поэтому
большинство специалистов советуют начинать с монолита, поддерживая его модульность, а к микросервисам переходить при 
появлении потребности в них и после проведения предварительной подготовки.

### Признаки для возможного выбора микросервисного подхода
- Большая команда: если у вас работает больше 10 человек, команда растет, все сложнее погружать новичков целиком в 
предметную область, то микросервисы помогут стандартизировать разработку и упростить командную работу.
- Множество взаимодействующих модулей в приложении: если их количество измеряется десятками, однозначно стоит 
задуматься о микросервисах.
- Объемный код: приложение с многомиллионными строками кода со временем все тяжелее поддерживать и развивать как монолит.
- Долгое время запуска приложений (полчаса и более): переход на микросервисы позволит устранить вынужденные простои и 
эффективно использовать время разработчиков.
- Различные требования к ресурсам в рамках одного приложения: использование микросервисов идеально в случаях, когда у
разных компонентов отличаются требования к ЦП, памяти и так далее.
- Для вашего бизнеса критична непрерывная доставка: если необходимо обеспечить своевременный выход обновлений, 
микросервисы являются предпочтительным вариантом, так как по скорости развертывания они значительно лучше монолитов.
- Высокий трафик со склонностью к периодическим всплескам нагрузки: микросервисы отлично сочетаются с 
автомасштабированием и облачной моделью, которые позволят использовать ресурсы только тогда, когда в них есть необходимость.

### Справочная информация
- [Плюсы и минусы микросервисов](https://habr.com/ru/post/261689/)
- [Простыми словами](https://habr.com/ru/post/480914/) и
- [Перевод статьи Мартина Фаулера/Джеймса Льюиса](https://habr.com/ru/post/249183/)


#### Вопросы
#### 1. Какие преимущества ты видишь у микросервисной архитектуры по сравнению с монолитом? А какие недостатки?
##### Плюсы 
- Жесткие границы модулей
- Независимый деплоймент
- Технологическое разнообразие
##### Минусы
- Увеличение распределённости
- Итоговая консистентность (Согласованность) 
- Эксплуатационная сложность

#### 2. Что ты использовал (или, о чем слышал) для трассировки сервисов? Для мониторинга? А для логирования?
- Elasticsearch
- Logstash
- Kibana
- Graylog

#### 3. Как быть с консистентностью данных между несколькими микросервисами? 
Хранить данные какое-то время для возможности восстановления/обновления данных.  
Как вариант использовать расп-ю транзакцию, которая является крайней сложной в реализации.

#### 4. Как происходит хранение данных?
Микросервис работает с конкретной моделью данных в БД, несколько инстансов могут работать как с одним экземпляром БД, 
так и с несколькими, но в таком случае писать должен master, а slaves только читать. В таком случае необходимо учитывать 
синхронизацию данных между экземплярами БД.
  
